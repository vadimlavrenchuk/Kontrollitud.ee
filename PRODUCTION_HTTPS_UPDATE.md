# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é nginx.conf –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω [frontend/nginx.conf](frontend/nginx.conf) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTPS
2. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –ø–∞–ø–∫–µ `ssl/`
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω [docker-compose.yml](docker-compose.yml) - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ—Ä—Ç 443 –∏ volume –¥–ª—è SSL

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Å HTTPS

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker-compose up --build
```

–¢–µ–ø–µ—Ä—å —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:
- **HTTP**: http://localhost:3000 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ HTTPS)
- **HTTPS**: https://localhost:3443

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ù–∞–∂–º–∏—Ç–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" ‚Üí "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞ localhost".

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@65.109.166.160

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /root/Kontrollitud.ee

# 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π nginx.conf
# (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ git pull –∏–ª–∏ scp)
git pull

# 4. –û–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml –¥–ª—è production
# –ó–∞–º–µ–Ω–∏—Ç–µ volume –¥–ª—è ssl –Ω–∞ –ø—É—Ç—å –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º Let's Encrypt
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```yaml
frontend:
  ports:
    - "80:80"
    - "443:443"
  volumes:
    # –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–µ–º Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
    - /etc/letsencrypt/live/kontrollitud.ee:/etc/nginx/ssl:ro
```

```bash
# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down
docker-compose up -d --build
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ Let's Encrypt –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

–ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ certbot
sudo apt-get update
sudo apt-get install certbot

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (certbot —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Ä—Ç 80)
cd /root/Kontrollitud.ee
docker-compose down

# 3. –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone \
  -d kontrollitud.ee \
  -d www.kontrollitud.ee \
  --email your-email@example.com \
  --agree-tos

# 4. –û–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml (—Å–º. –≤—ã—à–µ)

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d --build
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
sudo crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3 —É—Ç—Ä–∞)
0 3 * * * certbot renew --quiet --deploy-hook "cd /root/Kontrollitud.ee && docker-compose restart frontend"
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

```bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec frontend nginx -t

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP (–¥–æ–ª–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ HTTPS)
curl -I http://kontrollitud.ee

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
# HTTP/1.1 301 Moved Permanently
# Location: https://kontrollitud.ee/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -I https://kontrollitud.ee

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
# HTTP/2 200 
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
echo | openssl s_client -servername kontrollitud.ee -connect kontrollitud.ee:443 2>/dev/null | openssl x509 -noout -dates
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
curl -I https://kontrollitud.ee

# –î–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏:
# X-Frame-Options: SAMEORIGIN
# X-Content-Type-Options: nosniff
# X-XSS-Protection: 1; mode=block
# Referrer-Policy: strict-origin-when-cross-origin
```

## –û—Ç–∫–∞—Ç –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:

```bash
# 1. –û—Ç–∫–∞—Ç–∏—Ç–µ —Ñ–∞–π–ª nginx.conf
git checkout HEAD~1 frontend/nginx.conf

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down
docker-compose up -d --build
```

## –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–æ–∫–∞–ª—å–Ω–æ | Production |
|----------|----------|------------|
| –ü–æ—Ä—Ç—ã | 3000:80, 3443:443 | 80:80, 443:443 |
| SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã | `./ssl` (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ) | `/etc/letsencrypt/live/kontrollitud.ee` (Let's Encrypt) |
| –î–æ–º–µ–Ω | localhost | kontrollitud.ee |

## –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –õ–æ–≥–∏ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose logs frontend

# –õ–æ–≥–∏ nginx –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec frontend cat /var/log/nginx/error.log
docker-compose exec frontend cat /var/log/nginx/access.log

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f frontend
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã
sudo netstat -tlnp | grep :443

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ frontend
docker-compose restart frontend

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ –∫–µ—à–∞
docker-compose build --no-cache frontend
docker-compose up -d frontend
```

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è production

- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã
- [ ] –ü–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
- [ ] docker-compose.yml –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º
- [ ] nginx.conf —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- [ ] HTTP –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ HTTPS
- [ ] HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Security headers –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (cron)
- [ ] API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ HTTPS
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## –°—Å—ã–ª–∫–∏

- üìÑ [LOCAL_HTTPS_SETUP.md](LOCAL_HTTPS_SETUP.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTPS –ª–æ–∫–∞–ª—å–Ω–æ
- üîí [Let's Encrypt Documentation](https://letsencrypt.org/docs/)
- üìò [Nginx SSL Configuration](https://nginx.org/en/docs/http/configuring_https_servers.html)
